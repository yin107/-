{"ast":null,"code":"export default {\n  data() {\n    return {\n      usermessForm: {\n        real_name: \"\",\n        idcard: \"\",\n        avatar_url: undefined,\n        phone: undefined,\n        account: undefined,\n        password: undefined,\n        password2: undefined\n      },\n      //   需要自定义一些校验规则\n      usermessRules: {\n        real_name: [{\n          required: true,\n          message: \"请输入您的真实姓名\"\n        }, {\n          max: 8,\n          message: \"姓名不能超过8个字符\"\n        }],\n        idcard: [{\n          required: true,\n          message: \"请输入您的身份证号码\"\n        }, {\n          pattern: /^\\d{17}\\d|x$/i,\n          message: \"请输入正确的身份证号码\"\n        }],\n        phone: [{\n          required: true,\n          message: \"请输入您的手机号码\"\n        }, {\n          pattern: /^\\d{11}$/,\n          message: \"请输入正确的手机号码\"\n        }],\n        account: [{\n          required: true,\n          message: \"请输入账号\"\n        }, {\n          min: 4,\n          message: \"账号的长度应该大于4个字符\"\n        }],\n        password: [{\n          required: true,\n          message: \"请输入密码\"\n        }, {\n          min: 6,\n          message: \"密码的长度应该大于6个字符\"\n        }],\n        password2: [{\n          required: true,\n          message: \"请确认密码\"\n        }, {\n          min: 6,\n          message: \"密码的长度应该大于6个字符\"\n        }, {\n          validator: (rule, val, cb) => {\n            if (val && this.usermessForm.password && val === this.usermessForm.password) {\n              cb();\n            } else {\n              new Error(\"两次输入的密码不一致\");\n            }\n          },\n          message: \"两次输入的密码不一致\"\n        }]\n      },\n      commuForm: {\n        name: \"\",\n        address: [],\n        service_phone: \"\",\n        banner: \"\",\n        access_nfc: 0,\n        access_qrcode: 0,\n        access_remote: 0,\n        fitment_pledge: 0,\n        carport_max_car: 1\n      },\n      commuRules: {\n        name: [{\n          required: true,\n          message: \"请输入小区名称\"\n        }, {\n          max: 12,\n          message: \"小区名称不能超过12个字符\"\n        }],\n        address: [{\n          required: true\n        }],\n        service_phone: [{\n          required: true,\n          message: \"请输入小区客户电话\"\n        }, {\n          pattern: /^\\d{11}$/,\n          message: \"请输入正确的电话号码\"\n        }],\n        access_nfc: [{\n          required: true,\n          type: \"number\"\n        }],\n        access_qrcode: [{\n          required: true,\n          type: \"number\"\n        }],\n        access_remote: [{\n          required: true,\n          type: \"number\"\n        }],\n        fitment_pledge: [{\n          required: true,\n          type: \"number\"\n        }],\n        carport_max_car: [{\n          required: true,\n          pattern: /^\\d+$/,\n          message: \"请输入正确的车位可绑定车辆的数目\"\n        }]\n      }\n    };\n  },\n  methods: {\n    checkForm(forName) {\n      console.log(forName);\n      return new Promise((resolve, reject) => {\n        this.$refs[forName].validate(valid => {\n          if (valid) {\n            resolve(this.forName);\n          } else {\n            reject(\"请输入正确的信息\");\n          }\n        });\n      });\n    },\n    regester() {\n      // 先对两个form表单进行验证\n      Promise.all([this.checkForm(\"usermessForm\"), this.checkForm(\"commuForm\")]).then(res => {\n        console.log(res);\n        //表单验证成功的话，就发送请求\n        const {\n          code,\n          state\n        } = this.$route.query;\n        const data = {\n          ...this.usermessForm,\n          ...this.commuForm,\n          province: \"湖南省\",\n          city: \"邵阳市\",\n          district: \"洞口\",\n          code,\n          state\n        };\n        delete data.address;\n        this.$request({\n          url: \"/init/run\",\n          method: \"post\",\n          data: data\n        }).then(res => {\n          console.log(res);\n          this.notifySuccess(res.data.message);\n        }).catch(err => {\n          this.notifyError(err);\n        });\n      }).catch(err => {\n        this.notifyError(err);\n      });\n    }\n  }\n};","map":{"version":3,"names":["data","usermessForm","real_name","idcard","avatar_url","undefined","phone","account","password","password2","usermessRules","required","message","max","pattern","min","validator","rule","val","cb","Error","commuForm","name","address","service_phone","banner","access_nfc","access_qrcode","access_remote","fitment_pledge","carport_max_car","commuRules","type","methods","checkForm","forName","console","log","Promise","resolve","reject","$refs","validate","valid","regester","all","then","res","code","state","$route","query","province","city","district","$request","url","method","notifySuccess","catch","err","notifyError"],"sources":["src/views/user/init/index.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"header\">系统初始化信息</div>\r\n    <!-- 信息 -->\r\n    <div class=\"info\">\r\n      <!-- 个人信息 -->\r\n      <el-card class=\"box-card\">\r\n        <div slot=\"header\">\r\n          <span>个人基本资料</span>\r\n        </div>\r\n        <!-- form表单区域 -->\r\n\r\n        <el-form\r\n          ref=\"usermessForm\"\r\n          :rules=\"usermessRules\"\r\n          :model=\"usermessForm\"\r\n          inline\r\n        >\r\n          <el-form-item label=\"姓名\" prop=\"real_name\" width=\"200\">\r\n            <el-input v-model=\"usermessForm.real_name\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"身份证号码\" prop=\"idcard\">\r\n            <el-input v-model=\"usermessForm.idcard\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"手机号码\" prop=\"phone\">\r\n            <el-input v-model=\"usermessForm.phone\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"登录账号\" prop=\"account\">\r\n            <el-input v-model=\"usermessForm.account\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"登录密码\" prop=\"password\">\r\n            <el-input\r\n              v-model=\"usermessForm.password\"\r\n              type=\"password\"\r\n            ></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"确认登录密码\" prop=\"password2\">\r\n            <el-input\r\n              v-model=\"usermessForm.password2\"\r\n              type=\"password\"\r\n            ></el-input>\r\n          </el-form-item>\r\n        </el-form>\r\n      </el-card>\r\n\r\n      <!-- 小区信息 -->\r\n      <el-card class=\"box-card\">\r\n        <div slot=\"header\">\r\n          <span>初始化小区信息</span>\r\n        </div>\r\n        <el-form ref=\"commuForm\" :model=\"commuForm\" inline :rules=\"commuRules\">\r\n          <el-form-item label=\"小区名称\" prop=\"name\">\r\n            <el-input v-model=\"commuForm.name\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"小区所在地\" prop=\"address\">\r\n            <el-input v-model=\"commuForm.address\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"客服电话\" prop=\"service_phone\">\r\n            <el-input v-model=\"commuForm.service_phone\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"NFC门禁\" prop=\"access_nfc\">\r\n            <el-switch\r\n              v-model=\"commuForm.access_nfc\"\r\n              active-color=\"#13ce66\"\r\n              inactive-color=\"#ff4949\"\r\n              :active-value=\"1\"\r\n              :inactive-value=\"0\"\r\n            >\r\n            </el-switch>\r\n          </el-form-item>\r\n          <el-form-item label=\"二维码门禁\" prop=\"access_qrcode\">\r\n            <el-switch\r\n              v-model=\"commuForm.access_qrcode\"\r\n              active-color=\"#13ce66\"\r\n              inactive-color=\"#ff4949\"\r\n              :active-value=\"1\"\r\n              :inactive-value=\"0\"\r\n            >\r\n            </el-switch>\r\n          </el-form-item>\r\n          <el-form-item label=\"远程开门\" prop=\"access_remote\">\r\n            <el-switch\r\n              v-model=\"commuForm.access_remote\"\r\n              active-color=\"#13ce66\"\r\n              inactive-color=\"#ff4949\"\r\n              :active-value=\"1\"\r\n              :inactive-value=\"0\"\r\n            >\r\n            </el-switch>\r\n          </el-form-item>\r\n          <el-form-item label=\"装修保证金\" prop=\"fitment_pledge\">\r\n            <el-switch\r\n              v-model=\"commuForm.fitment_pledge\"\r\n              active-color=\"#13ce66\"\r\n              inactive-color=\"#ff4949\"\r\n              :active-value=\"1\"\r\n              :inactive-value=\"0\"\r\n            >\r\n            </el-switch>\r\n          </el-form-item>\r\n          <el-form-item label=\"车位绑定车辆数\" prop=\"carport_max_car\">\r\n            <el-input-number\r\n              v-model=\"commuForm.carport_max_car\"\r\n              controls-position=\"right\"\r\n              :min=\"1\"\r\n            ></el-input-number>\r\n          </el-form-item>\r\n        </el-form>\r\n      </el-card>\r\n    </div>\r\n    <button @click=\"$router.push({ name: 'login' })\">返回登录页</button>\r\n    <button @click=\"regester()\">注册</button>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      usermessForm: {\r\n        real_name: \"\",\r\n        idcard: \"\",\r\n\t\tavatar_url: undefined,\r\n        phone: undefined,\r\n        account: undefined,\r\n        password: undefined,\r\n        password2: undefined,\r\n      },\r\n      //   需要自定义一些校验规则\r\n      usermessRules: {\r\n        real_name: [\r\n          { required: true, message: \"请输入您的真实姓名\" },\r\n          { max: 8, message: \"姓名不能超过8个字符\" },\r\n        ],\r\n        idcard: [\r\n          { required: true, message: \"请输入您的身份证号码\" },\r\n          { pattern: /^\\d{17}\\d|x$/i, message: \"请输入正确的身份证号码\" },\r\n        ],\r\n        phone: [\r\n          { required: true, message: \"请输入您的手机号码\" },\r\n          { pattern: /^\\d{11}$/, message: \"请输入正确的手机号码\" },\r\n        ],\r\n        account: [\r\n          { required: true, message: \"请输入账号\" },\r\n          { min: 4, message: \"账号的长度应该大于4个字符\" },\r\n        ],\r\n        password: [\r\n          { required: true, message: \"请输入密码\" },\r\n          { min: 6, message: \"密码的长度应该大于6个字符\" },\r\n        ],\r\n        password2: [\r\n          { required: true, message: \"请确认密码\" },\r\n          { min: 6, message: \"密码的长度应该大于6个字符\" },\r\n          {\r\n            validator: (rule, val, cb) => {\r\n              if (\r\n                val &&\r\n                this.usermessForm.password &&\r\n                val === this.usermessForm.password\r\n              ) {\r\n                cb();\r\n              } else {\r\n                new Error(\"两次输入的密码不一致\");\r\n              }\r\n            },\r\n            message: \"两次输入的密码不一致\",\r\n          },\r\n        ],\r\n      },\r\n      commuForm: {\r\n        name: \"\",\r\n        address: [],\r\n        service_phone: \"\",\r\n        banner: \"\",\r\n        access_nfc: 0,\r\n        access_qrcode: 0,\r\n        access_remote: 0,\r\n        fitment_pledge: 0,\r\n        carport_max_car: 1,\r\n      },\r\n      commuRules: {\r\n        name: [\r\n          { required: true, message: \"请输入小区名称\" },\r\n          { max: 12, message: \"小区名称不能超过12个字符\" },\r\n        ],\r\n        address: [{ required: true }],\r\n        service_phone: [\r\n          { required: true, message: \"请输入小区客户电话\" },\r\n          { pattern: /^\\d{11}$/, message: \"请输入正确的电话号码\" },\r\n        ],\r\n        access_nfc: [{ required: true, type: \"number\" }],\r\n        access_qrcode: [{ required: true, type: \"number\" }],\r\n        access_remote: [{ required: true, type: \"number\" }],\r\n        fitment_pledge: [{ required: true, type: \"number\" }],\r\n        carport_max_car: [\r\n          {\r\n            required: true,\r\n            pattern: /^\\d+$/,\r\n            message: \"请输入正确的车位可绑定车辆的数目\",\r\n          },\r\n        ],\r\n      },\r\n    };\r\n  },\r\n  methods: {\r\n    checkForm(forName) {\r\n\t\tconsole.log(forName);\r\n      return new Promise((resolve, reject) => {\r\n        this.$refs[forName].validate((valid) => {\r\n          if (valid) {\r\n            resolve(this.forName);\r\n          } else {\r\n            reject(\"请输入正确的信息\");\r\n          }\r\n        });\r\n      });\r\n    },\r\n    regester() {\r\n      // 先对两个form表单进行验证\r\n      Promise.all([this.checkForm(\"usermessForm\"), this.checkForm(\"commuForm\")])\r\n        .then((res) => {\r\n\t\t\tconsole.log(res);\r\n          //表单验证成功的话，就发送请求\r\n          const { code, state } = this.$route.query;\r\n          const data = {\r\n            ...this.usermessForm,\r\n            ...this.commuForm,\r\n            province: \"湖南省\",\r\n            city: \"邵阳市\",\r\n            district: \"洞口\",\r\n            code,\r\n            state,\r\n          };\r\n          delete data.address;\r\n          this.$request({\r\n            url: \"/init/run\",\r\n            method: \"post\",\r\n            data: data,\r\n          })\r\n            .then((res) => {\r\n              console.log(res);\r\n              this.notifySuccess(res.data.message);\r\n            })\r\n            .catch((err) => {\r\n              this.notifyError(err);\r\n            });\r\n        })\r\n        .catch((err) => {\r\n          this.notifyError(err);\r\n        });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.header {\r\n  width: 100vw;\r\n  height: 80px;\r\n  line-height: 80px;\r\n  font-size: 25px;\r\n  text-align: center;\r\n  margin-bottom: 20px;\r\n  background-color: #fff;\r\n}\r\n.box-card {\r\n  width: 90%;\r\n  margin: 20px auto;\r\n}\r\n</style>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}