{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport breadCrumb from \"components/breadCrumb\";\nimport { mixins } from \"@/minxin\";\nexport default {\n  components: {\n    breadCrumb\n  },\n  mixins: [mixins],\n  name: \"detailVue\",\n  mounted() {\n    this.getData();\n  },\n  data() {\n    return {\n      petInfo: {},\n      vacciInfo: [],\n      updateInfo: false,\n      updateform: {\n        pet_license: \"\",\n        pet_license_award_at: \"\"\n      },\n      updaterules: {\n        pet_license: [{\n          required: true\n        }],\n        pet_license_award_at: [{\n          required: true\n        }]\n      },\n      columns: [{\n        prop: \"vaccinated_at\",\n        label: \"接种时间\"\n      }, {\n        prop: \"vaccine_type\",\n        label: \"接种类型\"\n      }],\n      updatevacciform: {\n        vaccinated_at: \"\",\n        vaccine_type: \"\"\n      },\n      updatevacci: false,\n      updatevaccirules: {\n        vaccinated_at: [{\n          required: true\n        }],\n        vaccine_type: [{\n          required: true\n        }]\n      },\n      multipleSelection: []\n    };\n  },\n  methods: {\n    //获取数据\n    getData() {\n      this.$request({\n        url: \"/pet/detail\",\n        method: \"post\",\n        data: {\n          community_id: this.community_id,\n          id: this.petId\n        }\n      }).then(res => {\n        this.petInfo = res.data.data.info;\n        this.vacciInfo = res.data.data.vaccinates;\n        this.vacciInfo = this.vacciInfo.map(item => {\n          item.vaccinated_at = this.standDate(item.vaccinated_at);\n          return item;\n        });\n      });\n    },\n    //更新宠物信息\n    updatePetInfo() {\n      ///先验证表单\n      this.$refs[\"updateform\"].validate(valid => {\n        if (valid) {\n          //向后端发送请求\n          this.$request({\n            url: `/pet/license/${this.petId}`,\n            method: \"post\",\n            data: {\n              community_id: this.community_id,\n              ...this.updateform\n            }\n          }).then(res => {\n            this.petInfo.pet_license = this.updateform.pet_license;\n            this.petInfo.pet_license_award_at = this.updateform.pet_license_award_at;\n            this.updateInfo = false;\n          });\n        }\n      });\n    },\n    //添加疫苗信息\n    updatevacciconfirm() {\n      this.$refs[\"updatevacciform\"].validate(valid => {\n        if (valid) {\n          this.$request({\n            url: `/pet/vaccinate/${this.petId}`,\n            method: \"post\",\n            data: {\n              community_id: this.community_id,\n              ...this.updatevacciform\n            }\n          }).then(() => {\n            this.vacciInfo.push(this.updatevacciform);\n            this.updatevacci = false;\n          });\n        }\n      });\n    },\n    //删除宠物疫苗接种记录处理\n    handleSelectionChange(val) {\n      this.multipleSelection = val;\n    },\n    //根基multipleSelction表示需要删除的记录，vacciInfo表示全部信息。首先发送请求给后端，返回成功后前端处理，在vacciInfo中删除multipleSelection的内容进行删除\n    deleteHis() {\n      if (this.multipleSelection.length == 0) {\n        this.notifyError(\"请选择需要删除的接种历史\");\n      } else {\n        this.$request({\n          url: \"/pet/deleteVacciHis\",\n          method: \"post\",\n          data: {\n            community_id: this.community_id,\n            id: this.petId,\n            deletItems: this.multipleSelection\n          }\n        }).then(res => {\n          console.log(res);\n          let totalVacci = this.vacciInfo.map(item => {\n            return JSON.stringify(item);\n          });\n          let deleteVacci = this.multipleSelection.map(item => {\n            return JSON.stringify(item);\n          });\n          console.log(totalVacci, deleteVacci);\n          totalVacci.filter(item => {\n            return !deleteVacci.includes(item);\n          });\n          console.log(totalVacci);\n        });\n      }\n    }\n  },\n  computed: {\n    petId() {\n      return this.$route.query.id;\n    }\n  }\n};","map":{"version":3,"names":["breadCrumb","mixins","components","name","mounted","getData","data","petInfo","vacciInfo","updateInfo","updateform","pet_license","pet_license_award_at","updaterules","required","columns","prop","label","updatevacciform","vaccinated_at","vaccine_type","updatevacci","updatevaccirules","multipleSelection","methods","$request","url","method","community_id","id","petId","then","res","info","vaccinates","map","item","standDate","updatePetInfo","$refs","validate","valid","updatevacciconfirm","push","handleSelectionChange","val","deleteHis","length","notifyError","deletItems","console","log","totalVacci","JSON","stringify","deleteVacci","filter","includes","computed","$route","query"],"sources":["src/views/basic/pet/detail.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <bread-crumb>\r\n      <span\r\n        slot=\"goback\"\r\n        style=\"float: right\"\r\n        @click=\"$router.go(-1)\"\r\n        class=\"doaction\"\r\n      >\r\n        返回</span\r\n      >\r\n    </bread-crumb>\r\n    <!-- 宠物信息 -->\r\n    <el-card class=\"box-card\">\r\n      <div slot=\"header\" class=\"clearfix\">\r\n        <span>宠物信息</span>\r\n        <span\r\n          style=\"color: blueviolet\"\r\n          @click=\"updateInfo = true\"\r\n          class=\"doaction\"\r\n          >更新登记证</span\r\n        >\r\n      </div>\r\n      <div class=\"content\">\r\n        <el-row>\r\n          <el-col :span=\"8\">宠物名称：{{ petInfo.name }}</el-col>\r\n          <el-col :span=\"8\">宠物类型：{{ petInfo.pet_type }}</el-col>\r\n          <el-col :span=\"8\">宠物品种：{{ petInfo.breed }}</el-col>\r\n        </el-row>\r\n        <el-row>\r\n          <el-col :span=\"8\">宠物毛色：{{ petInfo.coat_color }}</el-col>\r\n          <el-col :span=\"8\">小区名称：{{ petInfo.community_name }}</el-col>\r\n          <el-col :span=\"8\"\r\n            >宠物登记：<el-tag\r\n              :type=\"petInfo.pet_license ? 'success' : 'info'\"\r\n              >{{ petInfo.pet_license ? \"已登记\" : \"未登记\" }}</el-tag\r\n            ></el-col\r\n          >\r\n        </el-row>\r\n        <el-row>\r\n          <el-col :span=\"8\">证书编号：{{ petInfo.pet_license }}</el-col>\r\n          <el-col :span=\"8\"\r\n            >发证日期：{{\r\n              petInfo.pet_license_award_at | formatDate(\"YYYY-MM-DD\")\r\n            }}</el-col\r\n          >\r\n          <el-col :span=\"8\">主人信息：{{ petInfo.wechat_mp_user_id }}</el-col>\r\n        </el-row>\r\n        <el-row>\r\n          <el-col :span=\"8\"\r\n            >宠物照片：<img :src=\"petInfo.photo\" alt=\"\" width=\"80\" height=\"80\"\r\n          /></el-col>\r\n          <el-col :span=\"8\"\r\n            >是否注销：<el-tag :type=\"petInfo.remove ? 'success' : 'info'\">{{\r\n              petInfo.remove ? \"是\" : \"否\"\r\n            }}</el-tag></el-col\r\n          >\r\n          <el-col :span=\"8\" v-if=\"petInfo.remove\"\r\n            >注销时间：{{ petInfo.remove_at | formatDate() }}</el-col\r\n          >\r\n        </el-row>\r\n        <el-row v-if=\"petInfo.remove\">\r\n          <el-col :span=\"8\" v-if=\"petInfo.remove\"\r\n            >注销原因：{{ petInfo.remove_reason }}</el-col\r\n          >\r\n        </el-row>\r\n      </div>\r\n    </el-card>\r\n    <!-- 更新宠物登记信息 -->\r\n    <el-dialog :visible.sync=\"updateInfo\">\r\n      <span slot=\"title\">更新宠物登记证</span>\r\n      <el-form ref=\"updateform\" :model=\"updateform\" :rules=\"updaterules\">\r\n        <el-form-item prop=\"pet_license\" label=\"证书编号\">\r\n          <el-input\r\n            v-model=\"updateform.pet_license\"\r\n            placeholder=\"请输入登记编号\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item prop=\"pet_license_award_at\" label=\"发证日期\">\r\n          <el-date-picker\r\n            v-model=\"updateform.pet_license_award_at\"\r\n            type=\"date\"\r\n            placeholder=\"选择日期\"\r\n            format=\"yyyy年MM月dd日\"\r\n            value-format=\"timestamp\"\r\n            style=\"width: 300px; float: left\"\r\n          ></el-date-picker>\r\n        </el-form-item>\r\n      </el-form>\r\n      <span slot=\"footer\">\r\n        <el-button @click=\"updateInfo = false\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"updatePetInfo\">更新</el-button>\r\n      </span>\r\n    </el-dialog>\r\n\r\n    <!-- 一疫苗接种历史 -->\r\n    <el-card class=\"box-card\">\r\n      <div slot=\"header\" class=\"clearfix\">\r\n        <span>疫苗接种历史</span>\r\n        <span style=\"color: skyblue\" class=\"doaction\" @click=\"deleteHis\"\r\n          >删除</span\r\n        >\r\n        <span\r\n          style=\"color: blueviolet\"\r\n          @click=\"updatevacci = true\"\r\n          class=\"doaction\"\r\n          >添加</span\r\n        >\r\n      </div>\r\n      <el-table :data=\"vacciInfo\" @selection-change=\"handleSelectionChange\">\r\n        <el-table-column type=\"selection\"></el-table-column>\r\n        <el-table-column\r\n          v-for=\"item of columns\"\r\n          :key=\"item.prop\"\r\n          :prop=\"item.prop\"\r\n          :label=\"item.label\"\r\n        ></el-table-column>\r\n      </el-table>\r\n    </el-card>\r\n\r\n    <!-- 添加疫苗信息 -->\r\n    <el-dialog :visible.sync=\"updatevacci\">\r\n      <span slot=\"title\">疫苗接种信息</span>\r\n      <el-form\r\n        ref=\"updatevacciform\"\r\n        :model=\"updatevacciform\"\r\n        :rules=\"updatevaccirules\"\r\n      >\r\n        <el-form-item prop=\"vaccine_type\" label=\"疫苗类型\">\r\n          <el-input\r\n            v-model=\"updatevacciform.vaccine_type\"\r\n            placeholder=\"请输入疫苗类型\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item prop=\"vaccinated_at\" label=\"接种日期\">\r\n          <el-date-picker\r\n            v-model=\"updatevacciform.vaccinated_at\"\r\n            type=\"date\"\r\n            placeholder=\"选择接种日期\"\r\n            format=\"yyyy年MM月dd日\"\r\n            value-format=\"yyyy-MM-dd\"\r\n            style=\"width: 300px; float: left\"\r\n          ></el-date-picker>\r\n        </el-form-item>\r\n      </el-form>\r\n      <span slot=\"footer\">\r\n        <el-button @click=\"updatevacci = false\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"updatevacciconfirm\">确定</el-button>\r\n      </span>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport breadCrumb from \"components/breadCrumb\";\r\nimport { mixins } from \"@/minxin\";\r\nexport default {\r\n  components: { breadCrumb },\r\n  mixins: [mixins],\r\n  name: \"detailVue\",\r\n  mounted() {\r\n    this.getData();\r\n  },\r\n  data() {\r\n    return {\r\n      petInfo: {},\r\n      vacciInfo: [],\r\n      updateInfo: false,\r\n      updateform: {\r\n        pet_license: \"\",\r\n        pet_license_award_at: \"\",\r\n      },\r\n      updaterules: {\r\n        pet_license: [{ required: true }],\r\n        pet_license_award_at: [{ required: true }],\r\n      },\r\n      columns: [\r\n        { prop: \"vaccinated_at\", label: \"接种时间\" },\r\n        { prop: \"vaccine_type\", label: \"接种类型\" },\r\n      ],\r\n      updatevacciform: {\r\n        vaccinated_at: \"\",\r\n        vaccine_type: \"\",\r\n      },\r\n      updatevacci: false,\r\n      updatevaccirules: {\r\n        vaccinated_at: [{ required: true }],\r\n        vaccine_type: [{ required: true }],\r\n      },\r\n      multipleSelection: [],\r\n    };\r\n  },\r\n  methods: {\r\n    //获取数据\r\n    getData() {\r\n      this.$request({\r\n        url: \"/pet/detail\",\r\n        method: \"post\",\r\n        data: {\r\n          community_id: this.community_id,\r\n          id: this.petId,\r\n        },\r\n      }).then((res) => {\r\n        this.petInfo = res.data.data.info;\r\n        this.vacciInfo = res.data.data.vaccinates;\r\n        this.vacciInfo = this.vacciInfo.map((item) => {\r\n          item.vaccinated_at = this.standDate(item.vaccinated_at);\r\n          return item;\r\n        });\r\n      });\r\n    },\r\n    //更新宠物信息\r\n    updatePetInfo() {\r\n      ///先验证表单\r\n      this.$refs[\"updateform\"].validate((valid) => {\r\n        if (valid) {\r\n          //向后端发送请求\r\n          this.$request({\r\n            url: `/pet/license/${this.petId}`,\r\n            method: \"post\",\r\n            data: {\r\n              community_id: this.community_id,\r\n              ...this.updateform,\r\n            },\r\n          }).then((res) => {\r\n            this.petInfo.pet_license = this.updateform.pet_license;\r\n            this.petInfo.pet_license_award_at =\r\n              this.updateform.pet_license_award_at;\r\n            this.updateInfo = false;\r\n          });\r\n        }\r\n      });\r\n    },\r\n    //添加疫苗信息\r\n    updatevacciconfirm() {\r\n      this.$refs[\"updatevacciform\"].validate((valid) => {\r\n        if (valid) {\r\n          this.$request({\r\n            url: `/pet/vaccinate/${this.petId}`,\r\n            method: \"post\",\r\n            data: {\r\n              community_id: this.community_id,\r\n              ...this.updatevacciform,\r\n            },\r\n          }).then(() => {\r\n            this.vacciInfo.push(this.updatevacciform);\r\n            this.updatevacci = false;\r\n          });\r\n        }\r\n      });\r\n    },\r\n    //删除宠物疫苗接种记录处理\r\n    handleSelectionChange(val) {\r\n      this.multipleSelection = val;\r\n    },\r\n    //根基multipleSelction表示需要删除的记录，vacciInfo表示全部信息。首先发送请求给后端，返回成功后前端处理，在vacciInfo中删除multipleSelection的内容进行删除\r\n    deleteHis() {\r\n      if (this.multipleSelection.length == 0) {\r\n        this.notifyError(\"请选择需要删除的接种历史\");\r\n      } else {\r\n        this.$request({\r\n          url: \"/pet/deleteVacciHis\",\r\n          method: \"post\",\r\n          data: {\r\n            community_id: this.community_id,\r\n            id: this.petId,\r\n            deletItems: this.multipleSelection,\r\n          },\r\n        }).then((res) => {\r\n          console.log(res);\r\n          let totalVacci = this.vacciInfo.map((item) => {\r\n            return JSON.stringify(item);\r\n          });\r\n          let deleteVacci = this.multipleSelection.map((item) => {\r\n            return JSON.stringify(item);\r\n          });\r\n          console.log(totalVacci, deleteVacci);\r\n          totalVacci.filter((item) => {\r\n            return !deleteVacci.includes(item);\r\n          });\r\n          console.log(totalVacci);\r\n        });\r\n      }\r\n    },\r\n  },\r\n  computed: {\r\n    petId() {\r\n      return this.$route.query.id;\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.box-card {\r\n  margin-top: 20px;\r\n}\r\n.clearfix {\r\n  display: flex;\r\n  justify-content: space-between;\r\n}\r\n.content {\r\n  font-size: 15px;\r\n}\r\n.content img {\r\n  vertical-align: text-top;\r\n}\r\n</style>\r\n"],"mappings":";AA0JA,OAAAA,UAAA;AACA,SAAAC,MAAA;AACA;EACAC,UAAA;IAAAF;EAAA;EACAC,MAAA,GAAAA,MAAA;EACAE,IAAA;EACAC,QAAA;IACA,KAAAC,OAAA;EACA;EACAC,KAAA;IACA;MACAC,OAAA;MACAC,SAAA;MACAC,UAAA;MACAC,UAAA;QACAC,WAAA;QACAC,oBAAA;MACA;MACAC,WAAA;QACAF,WAAA;UAAAG,QAAA;QAAA;QACAF,oBAAA;UAAAE,QAAA;QAAA;MACA;MACAC,OAAA,GACA;QAAAC,IAAA;QAAAC,KAAA;MAAA,GACA;QAAAD,IAAA;QAAAC,KAAA;MAAA,EACA;MACAC,eAAA;QACAC,aAAA;QACAC,YAAA;MACA;MACAC,WAAA;MACAC,gBAAA;QACAH,aAAA;UAAAL,QAAA;QAAA;QACAM,YAAA;UAAAN,QAAA;QAAA;MACA;MACAS,iBAAA;IACA;EACA;EACAC,OAAA;IACA;IACAnB,QAAA;MACA,KAAAoB,QAAA;QACAC,GAAA;QACAC,MAAA;QACArB,IAAA;UACAsB,YAAA,OAAAA,YAAA;UACAC,EAAA,OAAAC;QACA;MACA,GAAAC,IAAA,CAAAC,GAAA;QACA,KAAAzB,OAAA,GAAAyB,GAAA,CAAA1B,IAAA,CAAAA,IAAA,CAAA2B,IAAA;QACA,KAAAzB,SAAA,GAAAwB,GAAA,CAAA1B,IAAA,CAAAA,IAAA,CAAA4B,UAAA;QACA,KAAA1B,SAAA,QAAAA,SAAA,CAAA2B,GAAA,CAAAC,IAAA;UACAA,IAAA,CAAAjB,aAAA,QAAAkB,SAAA,CAAAD,IAAA,CAAAjB,aAAA;UACA,OAAAiB,IAAA;QACA;MACA;IACA;IACA;IACAE,cAAA;MACA;MACA,KAAAC,KAAA,eAAAC,QAAA,CAAAC,KAAA;QACA,IAAAA,KAAA;UACA;UACA,KAAAhB,QAAA;YACAC,GAAA,uBAAAI,KAAA;YACAH,MAAA;YACArB,IAAA;cACAsB,YAAA,OAAAA,YAAA;cACA,QAAAlB;YACA;UACA,GAAAqB,IAAA,CAAAC,GAAA;YACA,KAAAzB,OAAA,CAAAI,WAAA,QAAAD,UAAA,CAAAC,WAAA;YACA,KAAAJ,OAAA,CAAAK,oBAAA,GACA,KAAAF,UAAA,CAAAE,oBAAA;YACA,KAAAH,UAAA;UACA;QACA;MACA;IACA;IACA;IACAiC,mBAAA;MACA,KAAAH,KAAA,oBAAAC,QAAA,CAAAC,KAAA;QACA,IAAAA,KAAA;UACA,KAAAhB,QAAA;YACAC,GAAA,yBAAAI,KAAA;YACAH,MAAA;YACArB,IAAA;cACAsB,YAAA,OAAAA,YAAA;cACA,QAAAV;YACA;UACA,GAAAa,IAAA;YACA,KAAAvB,SAAA,CAAAmC,IAAA,MAAAzB,eAAA;YACA,KAAAG,WAAA;UACA;QACA;MACA;IACA;IACA;IACAuB,sBAAAC,GAAA;MACA,KAAAtB,iBAAA,GAAAsB,GAAA;IACA;IACA;IACAC,UAAA;MACA,SAAAvB,iBAAA,CAAAwB,MAAA;QACA,KAAAC,WAAA;MACA;QACA,KAAAvB,QAAA;UACAC,GAAA;UACAC,MAAA;UACArB,IAAA;YACAsB,YAAA,OAAAA,YAAA;YACAC,EAAA,OAAAC,KAAA;YACAmB,UAAA,OAAA1B;UACA;QACA,GAAAQ,IAAA,CAAAC,GAAA;UACAkB,OAAA,CAAAC,GAAA,CAAAnB,GAAA;UACA,IAAAoB,UAAA,QAAA5C,SAAA,CAAA2B,GAAA,CAAAC,IAAA;YACA,OAAAiB,IAAA,CAAAC,SAAA,CAAAlB,IAAA;UACA;UACA,IAAAmB,WAAA,QAAAhC,iBAAA,CAAAY,GAAA,CAAAC,IAAA;YACA,OAAAiB,IAAA,CAAAC,SAAA,CAAAlB,IAAA;UACA;UACAc,OAAA,CAAAC,GAAA,CAAAC,UAAA,EAAAG,WAAA;UACAH,UAAA,CAAAI,MAAA,CAAApB,IAAA;YACA,QAAAmB,WAAA,CAAAE,QAAA,CAAArB,IAAA;UACA;UACAc,OAAA,CAAAC,GAAA,CAAAC,UAAA;QACA;MACA;IACA;EACA;EACAM,QAAA;IACA5B,MAAA;MACA,YAAA6B,MAAA,CAAAC,KAAA,CAAA/B,EAAA;IACA;EACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}